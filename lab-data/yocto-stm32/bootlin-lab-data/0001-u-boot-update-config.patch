From b0f4f8dce21cc1a019ac7f65b5afc2895e455c61 Mon Sep 17 00:00:00 2001
From: Alexandre Belloni <alexandre.belloni@bootlin.com>
Date: Sun, 28 Apr 2019 23:28:16 +0200
Subject: [PATCH] u-boot: update config

Signed-off-by: Alexandre Belloni <alexandre.belloni@bootlin.com>
---
 recipes-bsp/u-boot/u-boot-stm32mp-common_2018.11.inc |  1 +
 .../0009-ARM-v2018.11-stm32mp-r1-CONFIG.patch        | 20 ++++++++++++++++++++
 2 files changed, 21 insertions(+)
 create mode 100644 recipes-bsp/u-boot/u-boot-stm32mp/0009-ARM-v2018.11-stm32mp-r1-CONFIG.patch

diff --git a/recipes-bsp/u-boot/u-boot-stm32mp-common_2018.11.inc b/recipes-bsp/u-boot/u-boot-stm32mp-common_2018.11.inc
index ab0627ade51a..ee602a7bb29e 100644
--- a/recipes-bsp/u-boot/u-boot-stm32mp-common_2018.11.inc
+++ b/recipes-bsp/u-boot/u-boot-stm32mp-common_2018.11.inc
@@ -24,6 +24,7 @@ SRC_URI += " \
     file://0006-ARM-v2018.11-stm32mp-r2-MACHINE.patch \
     file://0007-ARM-v2018.11-stm32mp-r2-DEVICETREE.patch \
     file://0008-ARM-v2018.11-stm32mp-r2-MISC.patch \
+    file://0009-ARM-v2018.11-stm32mp-r1-CONFIG.patch \
     "
 
 U_BOOT_VERSION = "2018.11"
diff --git a/recipes-bsp/u-boot/u-boot-stm32mp/0009-ARM-v2018.11-stm32mp-r1-CONFIG.patch b/recipes-bsp/u-boot/u-boot-stm32mp/0009-ARM-v2018.11-stm32mp-r1-CONFIG.patch
new file mode 100644
index 000000000000..06c3c5d8482f
--- /dev/null
+++ b/recipes-bsp/u-boot/u-boot-stm32mp/0009-ARM-v2018.11-stm32mp-r1-CONFIG.patch
@@ -0,0 +1,20 @@
+--- a/configs/stm32mp15_trusted_defconfig 2019-04-25 22:22:23.924734348 +0000
++++ b/configs/stm32mp15_trusted_defconfig 2019-04-28 20:54:48.492275186 +0000
+@@ -34,6 +34,10 @@ CONFIG_CMD_EXT4_WRITE=y
+ CONFIG_CMD_MTDPARTS=y
+ CONFIG_CMD_UBI=y
+ CONFIG_DEFAULT_DEVICE_TREE="stm32mp157c-ev1"
++CONFIG_ENV_IS_IN_EXT4=y
++CONFIG_ENV_EXT4_INTERFACE="mmc"
++CONFIG_ENV_EXT4_DEVICE_AND_PART="0:4"
++CONFIG_ENV_EXT4_FILE="/uboot.env"
+ CONFIG_STM32_ADC=y
+ CONFIG_USB_FUNCTION_FASTBOOT=y
+ CONFIG_FASTBOOT_BUF_ADDR=0xC0000000
+@@ -99,6 +103,5 @@ CONFIG_VIDEO_STM32=y
+ CONFIG_VIDEO_STM32_DSI=y
+ CONFIG_VIDEO_STM32_MAX_XRES=1280
+ CONFIG_VIDEO_STM32_MAX_YRES=800
+-CONFIG_STM32MP_WATCHDOG=y
+ CONFIG_FDT_FIXUP_PARTITIONS=y
+ # CONFIG_EFI_LOADER is not set
-- 
2.7.4

